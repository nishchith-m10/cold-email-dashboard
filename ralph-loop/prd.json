{
  "project": "cold-email-dashboard",
  "branchName": "ralph/domain3-campaign-isolation-partitioning",
  "description": "Domain 3: Campaign Isolation & Data Partitioning",
  "userStories": [
    {
      "id": "D3-001",
      "title": "Per-campaign workflow deployer function",
      "description": "Create lib/genesis/campaign-workflow-deployer.ts with deployForCampaign() that loads templates, builds campaign-specific variable map, and deploys 7 workflows named [{workspace}] {template} — {campaign}. Wire into POST /api/campaigns/provision to trigger deployment when workspace has active ignition.",
      "acceptanceCriteria": [
        "deployForCampaign(workspaceId, campaignId, campaignName, workspaceName, workspaceSlug) exported",
        "Loads droplet_ip from genesis.partition_registry",
        "Loads 7 templates via email_provider_config provider selection",
        "YOUR_CAMPAIGN_NAME set to campaign-specific name",
        "Workflow names include campaign suffix: [{workspace}] {template} — {campaign}",
        "Returns array of deployed workflow IDs",
        "Campaign provision route calls deployer when ignition status is active",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Committed as 07e795d"
    },
    {
      "id": "D3-002",
      "title": "Add campaign_group_id column to email_events",
      "description": "Migration to add campaign_group_id UUID column to email_events with partial index. Update event ingestion API to accept and store campaign_group_id.",
      "acceptanceCriteria": [
        "Migration adds campaign_group_id UUID column (nullable) to email_events",
        "Partial index on campaign_group_id WHERE NOT NULL",
        "Event ingestion route accepts campaign_group_id in payload",
        "Event ingestion stores campaign_group_id when provided",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Committed as 2bebbc7"
    },
    {
      "id": "D3-003",
      "title": "Add composite indexes for campaign query performance",
      "description": "Migration adding composite indexes: (workspace_id, event_type, event_ts), (workspace_id, campaign_name), (workspace_id, day) on daily_stats, (workspace_id, created_at) on llm_usage.",
      "acceptanceCriteria": [
        "idx_email_events_ws_type_ts on (workspace_id, event_type, event_ts)",
        "idx_email_events_ws_campaign on (workspace_id, campaign_name)",
        "idx_daily_stats_ws_day on (workspace_id, day)",
        "idx_llm_usage_ws_created on (workspace_id, created_at)",
        "All indexes use IF NOT EXISTS",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Committed as 0ff9a12"
    },
    {
      "id": "D3-004",
      "title": "Normalize campaign dropdown to use campaigns table",
      "description": "Update aggregate route campaign list to query from campaigns table (source of truth) instead of deriving from email_events campaign_name. Include campaign status and event count.",
      "acceptanceCriteria": [
        "Campaign list fetched from campaigns table filtered by workspace_id",
        "Each campaign includes name and status",
        "Fallback to existing behavior if campaigns query fails",
        "campaignList sorted alphabetically by name",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Committed as f33998e"
    }
  ]
}
